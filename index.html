<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Compound Interest Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-color: #f8f9fa;
            --container-bg: #ffffff;
            --text-main: #1f2937;
            --text-muted: #6b7280;
            --border-color: #e5e7eb;
            --input-bg: #ffffff;
            --primary-color: #2563eb;
            --primary-hover: #1d4ed8;
            --card-bg: #f8faff;
            --chart-grid: #f3f4f6;
            --chart-text: #6b7280;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        [data-theme="dark"] {
            --bg-color: #111827;
            --container-bg: #1f2937;
            --text-main: #f9fafb;
            --text-muted: #9ca3af;
            --border-color: #374151;
            --input-bg: #374151;
            --primary-color: #3b82f6;
            --primary-hover: #60a5fa;
            --card-bg: #1f2937;
            --chart-grid: #374151;
            --chart-text: #9ca3af;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            padding: 20px; 
            background-color: var(--bg-color); 
            color: var(--text-main);
            transition: background-color 0.2s ease, color 0.2s ease;
            margin: 0;
        }

        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: var(--container-bg); 
            padding: 40px; 
            border-radius: 12px; 
            box-shadow: var(--shadow); 
        }

        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            gap: 15px;
        }
        
        h2 { margin: 0; font-weight: 700; font-size: 1.5rem; }

        .controls { display: flex; gap: 10px; align-items: center; }

        select.lang-select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--input-bg);
            color: var(--text-main);
            cursor: pointer;
            font-size: 0.9rem;
        }

        .theme-toggle {
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            width: 38px;
            height: 38px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: var(--text-main);
            transition: background 0.2s;
        }
        .theme-toggle:hover { background-color: var(--border-color); }

        .row { display: flex; gap: 20px; margin-bottom: 20px; }
        .col { flex: 1; }
        
        label { display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-muted); font-size: 0.875rem; }
        
        input, select:not(.lang-select) { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid var(--border-color); 
            border-radius: 6px; 
            font-size: 1rem; 
            box-sizing: border-box; 
            background-color: var(--input-bg); 
            color: var(--text-main); 
            transition: border-color 0.15s;
        }
        input:focus, select:focus { border-color: var(--primary-color); outline: none; }
        
        .btn-calc { 
            width: 100%; 
            padding: 14px; 
            background-color: var(--primary-color); 
            color: white; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 1rem; 
            font-weight: 600; 
            margin-top: 10px; 
            transition: background-color 0.2s;
        }
        .btn-calc:hover { background-color: var(--primary-hover); }

        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        .btn-download { 
            flex: 1; 
            padding: 10px; 
            background-color: var(--bg-color); 
            color: var(--text-muted); 
            border: 1px solid var(--border-color); 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 0.875rem; 
            font-weight: 500; 
            transition: all 0.2s; 
        }
        .btn-download:hover { background-color: var(--border-color); color: var(--text-main); }
        
        .summary-grid { display: flex; gap: 15px; margin-bottom: 30px; margin-top: 25px; }
        .summary-card { 
            flex: 1; 
            background: var(--card-bg); 
            padding: 15px; 
            border-radius: 8px; 
            text-align: center; 
            border: 1px solid var(--border-color); 
        }
        .summary-label { font-size: 0.7rem; color: var(--text-muted); font-weight: 600; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.05em; }
        .summary-value { font-size: 1.25rem; font-weight: 700; color: var(--text-main); }
        .summary-value.highlight { color: var(--primary-color); }
        .summary-value.green { color: #10b981; }

        .chart-container { position: relative; height: 400px; width: 100%; margin-top: 20px; }
        
        .footer { text-align: center; margin-top: 40px; color: var(--text-muted); font-size: 0.8rem; }

        @media (max-width: 600px) {
            .row, .summary-grid, .btn-group { flex-direction: column; }
            .col { margin-bottom: 15px; }
            .container { padding: 20px; }
            .header-row { flex-direction: column; align-items: flex-start; }
            .controls { width: 100%; justify-content: space-between; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-row">
        <h2 id="txt-title">Compound Interest Calculator</h2>
        <div class="controls">
            <select id="lang-select" onchange="changeLanguage()" class="lang-select">
                <option value="en">English</option>
                <option value="es">Espa√±ol</option>
                <option value="fr">Fran√ßais</option>
                <option value="de">Deutsch</option>
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                <option value="zh">ÁÆÄ‰Ωì‰∏≠Êñá</option>
                <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
            </select>
            <button class="theme-toggle" onclick="toggleTheme()" id="theme-btn">üåô</button>
        </div>
    </div>

    <div class="row">
        <div class="col">
            <label id="lbl-currency">Currency</label>
            <select id="currency-select" onchange="updateSymbol()">
                <option value="$" selected>USD ($)</option>
                <option value="¬£">GBP (¬£)</option>
                <option value="‚Ç¨">EUR (‚Ç¨)</option>
                <option value="¬•">JPY (¬•)</option>
                <option value="MOP$">MOP$</option>
            </select>
        </div>
        <div class="col">
            <label><span id="lbl-principal">Initial Deposit</span> (<span class="curr-symbol">$</span>)</label>
            <input type="number" id="principal" value="1000">
        </div>
    </div>

    <div class="row">
        <div class="col">
            <label id="lbl-frequency">Frequency</label>
            <select id="frequency">
                <option value="52" id="opt-week">Weekly</option>
                <option value="12" selected id="opt-month">Monthly</option>
                <option value="1" id="opt-year">Annually</option>
            </select>
        </div>
        <div class="col">
            <label><span id="lbl-contribution">Contribution</span> (<span class="curr-symbol">$</span>)</label>
            <input type="number" id="contribution" value="200">
        </div>
    </div>

    <div class="row">
        <div class="col">
            <label><span id="lbl-rate">Interest Rate</span> (%)</label>
            <input type="number" id="rate" value="7">
        </div>
        <div class="col">
            <label id="lbl-years">Years to Grow</label>
            <input type="number" id="years" value="10">
        </div>
    </div>

    <button class="btn-calc" onclick="calculateAndDraw()" id="btn-calculate">Calculate Growth</button>

    <div class="summary-grid">
        <div class="summary-card">
            <div class="summary-label" id="lbl-total-invested">Total Invested</div>
            <div class="summary-value" id="val-invested">$0</div>
        </div>
        <div class="summary-card">
            <div class="summary-label" id="lbl-interest-earned">Interest Earned</div>
            <div class="summary-value green" id="val-interest">$0</div>
        </div>
        <div class="summary-card">
            <div class="summary-label" id="lbl-total-value">Total Value</div>
            <div class="summary-value highlight" id="val-total">$0</div>
        </div>
    </div>

    <div class="chart-container">
        <canvas id="growthChart"></canvas>
    </div>
    
    <div class="btn-group">
        <button class="btn-download" onclick="downloadCSV()" id="btn-csv">Download CSV</button>
        <button class="btn-download" onclick="downloadChart()" id="btn-img">Download Chart</button>
    </div>

</div>

<div class="footer">
    &copy; <span id="copyright-year"></span>
</div>

<script>
    let myChart = null;
    let isDarkMode = false;
    
    const translations = {
        en: {
            title: "Compound Interest Calculator", currency: "Currency", principal: "Initial Deposit", frequency: "Frequency", contribution: "Contribution", rate: "Interest Rate", years: "Years to Grow", calculate: "Calculate Growth", invested: "Total Invested", interest: "Interest Earned", total: "Total Value", csv: "Download CSV", img: "Download Chart", week: "Weekly", month: "Monthly", year: "Annually", chartLabel1: "Total Value", chartLabel2: "Principal Invested", chartYear: "Year"
        },
        es: {
            title: "Calculadora de Inter√©s Compuesto", currency: "Moneda", principal: "Dep√≥sito Inicial", frequency: "Frecuencia", contribution: "Contribuci√≥n", rate: "Tasa de Inter√©s", years: "A√±os a Crecer", calculate: "Calcular Crecimiento", invested: "Total Invertido", interest: "Inter√©s Ganado", total: "Valor Total", csv: "Descargar CSV", img: "Descargar Imagen", week: "Semanal", month: "Mensual", year: "Anual", chartLabel1: "Valor Total", chartLabel2: "Capital Invertido", chartYear: "A√±o"
        },
        fr: {
            title: "Calculatrice d'Int√©r√™ts Compos√©s", currency: "Devise", principal: "D√©p√¥t Initial", frequency: "Fr√©quence", contribution: "Contribution", rate: "Taux d'Int√©r√™t", years: "Dur√©e (Ann√©es)", calculate: "Calculer", invested: "Total Investi", interest: "Int√©r√™ts Gagn√©s", total: "Valeur Totale", csv: "T√©l√©charger CSV", img: "T√©l√©charger Image", week: "Hebdomadaire", month: "Mensuel", year: "Annuel", chartLabel1: "Valeur Totale", chartLabel2: "Capital Investi", chartYear: "Ann√©e"
        },
        de: {
            title: "Zinseszinsrechner", currency: "W√§hrung", principal: "Startkapital", frequency: "H√§ufigkeit", contribution: "Sparrate", rate: "Zinssatz", years: "Laufzeit (Jahre)", calculate: "Berechnen", invested: "Investiertes Kapital", interest: "Gewonnene Zinsen", total: "Gesamtwert", csv: "CSV Herunterladen", img: "Bild Herunterladen", week: "W√∂chentlich", month: "Monatlich", year: "J√§hrlich", chartLabel1: "Gesamtwert", chartLabel2: "Investiertes Kapital", chartYear: "Jahr"
        },
        ru: {
            title: "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –°–ª–æ–∂–Ω–æ–≥–æ –ü—Ä–æ—Ü–µ–Ω—Ç–∞", currency: "–í–∞–ª—é—Ç–∞", principal: "–ù–∞—á–∞–ª—å–Ω—ã–π –î–µ–ø–æ–∑–∏—Ç", frequency: "–ß–∞—Å—Ç–æ—Ç–∞", contribution: "–í–∑–Ω–æ—Å", rate: "–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è –°—Ç–∞–≤–∫–∞", years: "–°—Ä–æ–∫ (–õ–µ—Ç)", calculate: "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å", invested: "–í—Å–µ–≥–æ –í–ª–æ–∂–µ–Ω–æ", interest: "–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –ü—Ä–æ—Ü–µ–Ω—Ç–æ–≤", total: "–ò—Ç–æ–≥–æ–≤–∞—è –°—É–º–º–∞", csv: "–°–∫–∞—á–∞—Ç—å CSV", img: "–°–∫–∞—á–∞—Ç—å –ì—Ä–∞—Ñ–∏–∫", week: "–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ", month: "–ï–∂–µ–º–µ—Å—è—á–Ω–æ", year: "–ï–∂–µ–≥–æ–¥–Ω–æ", chartLabel1: "–ò—Ç–æ–≥–æ–≤–∞—è –°—É–º–º–∞", chartLabel2: "–í–ª–æ–∂–µ–Ω–Ω—ã–π –ö–∞–ø–∏—Ç–∞–ª", chartYear: "–ì–æ–¥"
        },
        zh: {
            title: "Â§çÂà©ËÆ°ÁÆóÂô®", currency: "Ë¥ßÂ∏Å", principal: "ÂàùÂßãÂ≠òÊ¨æ", frequency: "È¢ëÁéá", contribution: "ÂÆöÊúü‰æõÊ¨æ", rate: "Âπ¥Âà©Áéá", years: "ÊäïËµÑÂπ¥Êúü", calculate: "ËÆ°ÁÆóÂ¢ûÈïø", invested: "ÊÄªÊäïËµÑÈ¢ù", interest: "ËµöÂèñÂà©ÊÅØ", total: "ÊÄª‰ª∑ÂÄº", csv: "‰∏ãËΩΩ CSV Êä•Âëä", img: "‰∏ãËΩΩÂõæË°®", week: "ÊØèÂë®", month: "ÊØèÊúà", year: "ÊØèÂπ¥", chartLabel1: "ÊÄª‰ª∑ÂÄº", chartLabel2: "Êú¨ÈáëÊäïÂÖ•", chartYear: "Âπ¥"
        },
        hi: {
            title: "‡§ö‡§ï‡•ç‡§∞‡§µ‡•É‡§¶‡•ç‡§ß‡§ø ‡§¨‡•ç‡§Ø‡§æ‡§ú ‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞", currency: "‡§Æ‡•Å‡§¶‡•ç‡§∞‡§æ", principal: "‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠‡§ø‡§ï ‡§ú‡§Æ‡§æ", frequency: "‡§Ü‡§µ‡•É‡§§‡•ç‡§§‡§ø", contribution: "‡§Ø‡•ã‡§ó‡§¶‡§æ‡§®", rate: "‡§¨‡•ç‡§Ø‡§æ‡§ú ‡§¶‡§∞", years: "‡§Ö‡§µ‡§ß‡§ø (‡§µ‡§∞‡•ç‡§∑)", calculate: "‡§ó‡§£‡§®‡§æ ‡§ï‡§∞‡•á‡§Ç", invested: "‡§ï‡•Å‡§≤ ‡§®‡§ø‡§µ‡•á‡§∂", interest: "‡§Ö‡§∞‡•ç‡§ú‡§ø‡§§ ‡§¨‡•ç‡§Ø‡§æ‡§ú", total: "‡§ï‡•Å‡§≤ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø", csv: "CSV ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç", img: "‡§ó‡•ç‡§∞‡§æ‡§´ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç", week: "‡§∏‡§æ‡§™‡•ç‡§§‡§æ‡§π‡§ø‡§ï", month: "‡§Æ‡§æ‡§∏‡§ø‡§ï", year: "‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï", chartLabel1: "‡§ï‡•Å‡§≤ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø", chartLabel2: "‡§®‡§ø‡§µ‡•á‡§∂ ‡§Æ‡•Ç‡§≤‡§ß‡§®", chartYear: "‡§µ‡§∞‡•ç‡§∑"
        },
        ar: {
            title: "ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑŸÅÿßÿ¶ÿØÿ© ÿßŸÑŸÖÿ±ŸÉÿ®ÿ©", currency: "ÿßŸÑÿπŸÖŸÑÿ©", principal: "ÿßŸÑŸàÿØŸäÿπÿ© ÿßŸÑÿ£ŸàŸÑŸäÿ©", frequency: "ÿßŸÑÿ™ŸÉÿ±ÿßÿ±", contribution: "ŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿ≥ÿßŸáŸÖÿ©", rate: "ÿ≥ÿπÿ± ÿßŸÑŸÅÿßÿ¶ÿØÿ©", years: "ÿßŸÑŸÖÿØÿ© (ÿ≥ŸÜŸàÿßÿ™)", calculate: "ÿßÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸÖŸà", invested: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ≥ÿ™ÿ´ŸÖÿ±", interest: "ÿßŸÑŸÅÿßÿ¶ÿØÿ© ÿßŸÑŸÖŸÉÿ™ÿ≥ÿ®ÿ©", total: "ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©", csv: "ÿ™ÿ≠ŸÖŸäŸÑ ÿ™ŸÇÿ±Ÿäÿ± CSV", img: "ÿ™ÿ≠ŸÖŸäŸÑ ÿµŸàÿ±ÿ© ÿßŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸä", week: "ÿ£ÿ≥ÿ®ŸàÿπŸä", month: "ÿ¥Ÿáÿ±Ÿä", year: "ÿ≥ŸÜŸàŸä", chartLabel1: "ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©", chartLabel2: "ÿ±ÿ£ÿ≥ ÿßŸÑŸÖÿßŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿ´ŸÖÿ±", chartYear: "ÿ≥ŸÜÿ©"
        }
    };

    window.onload = function() {
        document.getElementById('copyright-year').innerText = new Date().getFullYear();
        if (localStorage.getItem('theme') === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('theme-btn').innerText = '‚òÄÔ∏è';
            isDarkMode = true;
        }
        updateSymbol();
        calculateAndDraw();
    };

    function changeLanguage() {
        const lang = document.getElementById('lang-select').value;
        const t = translations[lang];

        if (lang === 'ar') {
            document.documentElement.setAttribute('dir', 'rtl');
            document.body.style.textAlign = 'right';
        } else {
            document.documentElement.setAttribute('dir', 'ltr');
            document.body.style.textAlign = 'left';
        }

        document.getElementById('txt-title').innerText = t.title;
        document.getElementById('lbl-currency').innerText = t.currency;
        document.getElementById('lbl-principal').innerText = t.principal;
        document.getElementById('lbl-frequency').innerText = t.frequency;
        document.getElementById('lbl-contribution').innerText = t.contribution;
        document.getElementById('lbl-rate').innerText = t.rate;
        document.getElementById('lbl-years').innerText = t.years;
        document.getElementById('btn-calculate').innerText = t.calculate;
        document.getElementById('lbl-total-invested').innerText = t.invested;
        document.getElementById('lbl-interest-earned').innerText = t.interest;
        document.getElementById('lbl-total-value').innerText = t.total;
        document.getElementById('btn-csv').innerText = t.csv;
        document.getElementById('btn-img').innerText = t.img;
        document.getElementById('opt-week').innerText = t.week;
        document.getElementById('opt-month').innerText = t.month;
        document.getElementById('opt-year').innerText = t.year;
        calculateAndDraw();
    }

    function toggleTheme() {
        const btn = document.getElementById('theme-btn');
        const html = document.documentElement;
        if (html.getAttribute('data-theme') === 'dark') {
            html.removeAttribute('data-theme');
            btn.innerText = 'üåô';
            localStorage.setItem('theme', 'light');
            isDarkMode = false;
        } else {
            html.setAttribute('data-theme', 'dark');
            btn.innerText = '‚òÄÔ∏è';
            localStorage.setItem('theme', 'dark');
            isDarkMode = true;
        }
        calculateAndDraw();
    }

    function updateSymbol() {
        const symbol = document.getElementById('currency-select').value;
        const spans = document.getElementsByClassName('curr-symbol');
        for(let span of spans) { span.innerText = symbol; }
        calculateAndDraw();
    }

    function formatMoney(value) {
        if (value >= 1000000000000) return (value / 1000000000000).toFixed(1) + 'T';
        if (value >= 1000000000) return (value / 1000000000).toFixed(1) + 'B';
        if (value >= 1000000) return (value / 1000000).toFixed(1) + 'M';
        if (value >= 1000) return (value / 1000).toFixed(1) + 'k';
        return value.toFixed(0);
    }

    function calculateAndDraw() {
        const lang = document.getElementById('lang-select').value;
        const t = translations[lang];
        const symbol = document.getElementById('currency-select').value;
        const P = parseFloat(document.getElementById('principal').value);
        const c = parseFloat(document.getElementById('contribution').value);
        const r = parseFloat(document.getElementById('rate').value) / 100;
        const years = parseInt(document.getElementById('years').value);
        const freq = parseInt(document.getElementById('frequency').value);

        const labels = [];
        const dataBalance = [];
        const dataInvested = [];
        let currentBalance = P;
        let totalInvested = P;

        const ratePerPeriod = r / freq;
        const totalPeriods = years * freq;

        labels.push(t.chartYear + " 0");
        dataBalance.push(P);
        dataInvested.push(P);

        let periodsPerYearCounter = 0;
        let currentYear = 1;

        for (let i = 1; i <= totalPeriods; i++) {
            currentBalance += c;
            currentBalance *= (1 + ratePerPeriod);
            totalInvested += c;
            periodsPerYearCounter++;

            if (periodsPerYearCounter === freq) {
                const yearLabel = (lang === 'zh') ? t.chartYear + " " + currentYear + " Âπ¥" : t.chartYear + " " + currentYear;
                labels.push(yearLabel);
                dataBalance.push(currentBalance.toFixed(2));
                dataInvested.push(totalInvested.toFixed(2));
                periodsPerYearCounter = 0;
                currentYear++;
            }
        }

        const finalVal = parseFloat(dataBalance[dataBalance.length - 1]);
        const finalInvested = parseFloat(dataInvested[dataInvested.length - 1]);
        const totalInterest = finalVal - finalInvested;

        document.getElementById('val-total').innerText = symbol + formatMoney(finalVal);
        document.getElementById('val-invested').innerText = symbol + formatMoney(finalInvested);
        document.getElementById('val-interest').innerText = symbol + formatMoney(totalInterest);

        const styles = getComputedStyle(document.body);
        const gridColor = styles.getPropertyValue('--chart-grid').trim();
        const textColor = styles.getPropertyValue('--chart-text').trim();

        if (myChart) { myChart.destroy(); }

        const ctx = document.getElementById('growthChart').getContext('2d');
        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: t.chartLabel1,
                        data: dataBalance,
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 6
                    },
                    {
                        label: t.chartLabel2,
                        data: dataInvested,
                        borderColor: textColor,
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 6
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    tooltip: {
                        callbacks: { label: function(context) { return context.dataset.label + ': ' + symbol + formatMoney(context.raw); } },
                        backgroundColor: isDarkMode ? '#374151' : 'rgba(255, 255, 255, 0.95)',
                        titleColor: isDarkMode ? '#fff' : '#111',
                        bodyColor: isDarkMode ? '#fff' : '#111',
                        borderColor: isDarkMode ? '#4b5563' : '#e5e7eb',
                        borderWidth: 1,
                        padding: 10
                    },
                    legend: { labels: { color: textColor, usePointStyle: true, font: { weight: '600' } } }
                },
                scales: {
                    y: { beginAtZero: true, ticks: { callback: function(value) { return symbol + formatMoney(value); }, color: textColor }, grid: { color: gridColor } },
                    x: { ticks: { color: textColor }, grid: { display: false } }
                }
            }
        });
    }

    function downloadCSV() {
        const P = parseFloat(document.getElementById('principal').value);
        const c = parseFloat(document.getElementById('contribution').value);
        const r = parseFloat(document.getElementById('rate').value) / 100;
        const years = parseInt(document.getElementById('years').value);
        const freq = parseInt(document.getElementById('frequency').value);
        
        let csvContent = "data:text/csv;charset=utf-8,";
        csvContent += "Year,Total Balance,Total Contributed,Total Interest Earned\n";

        let currentBalance = P;
        let totalContributed = P;
        const ratePerPeriod = r / freq;
        const totalPeriods = years * freq;
        let periodsPerYearCounter = 0;
        let currentYear = 1;

        csvContent += "0," + P.toFixed(2) + "," + P.toFixed(2) + ",0.00\n";

        for (let i = 1; i <= totalPeriods; i++) {
            currentBalance += c;
            currentBalance *= (1 + ratePerPeriod);
            totalContributed += c;
            periodsPerYearCounter++;

            if (periodsPerYearCounter === freq) {
                let totalInterest = currentBalance - totalContributed;
                csvContent += currentYear + "," + currentBalance.toFixed(2) + "," + totalContributed.toFixed(2) + "," + totalInterest.toFixed(2) + "\n";
                periodsPerYearCounter = 0;
                currentYear++;
            }
        }
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "wealth_plan.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function downloadChart() {
        const canvas = document.getElementById('growthChart');
        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = canvas.width;
        tempCanvas.height = canvas.height;
        const tempCtx = tempCanvas.getContext('2d');
        tempCtx.fillStyle = isDarkMode ? '#1f2937' : '#FFFFFF';
        tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
        tempCtx.drawImage(canvas, 0, 0);
        const imageLink = tempCanvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.download = 'wealth_chart.png';
        link.href = imageLink;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
</script>

</body>
</html>
